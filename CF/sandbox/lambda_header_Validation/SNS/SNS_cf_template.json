{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "Cloud Formation Template To Create SNS Topic And Subscription",
  "Parameters": {
    "TopicSuccess": {
      "Description": "SNS Topic Name",
      "Type": "String"
    },
    "TopicFailed": {
      "Description": "SNS Topic Name",
      "Type": "String"
    },
    "SubscriptionEndPoint": {
      "Type": "String",
      "Description": "The endpoint that receives notifications from the Amazon SNS topic. The endpoint value depends on the protocol that you specify. This could be a URL or ARN"
    },
    "SubscriptionProtocol": {
      "Type": "String",
      "Description": "The subscription's protocol",
      "AllowedValues": [
        "http",
        "https",
        "email",
        "email-json",
        "sms",
        "sqs",
        "application",
        "lambda"
      ],
      "Default": "email"
    }
  },
  "Resources": {
    "SNSTopicSendErrorEmail": {
      "Type": "AWS::SNS::Topic",
      "Properties": {
        "TopicName": {"Ref": "TopicFailed"}
      }
    },
    "SNSSubscriptionFail": {
      "Type": "AWS::SNS::Subscription",
      "Properties": {
        "Endpoint": {
          "Ref": "SubscriptionEndPoint"
        },
        "Protocol": {
          "Ref": "SubscriptionProtocol"
        },
        "TopicArn": {
          "Ref": "SNSTopicSendErrorEmail"
        }
      }
    },
    "SNSTopicSendSuccessEmail": {
      "Type": "AWS::SNS::Topic",
      "Properties": {
        "TopicName": {"Ref": "TopicSuccess"}
      }
    },
    "SNSSubscriptionSuccess": {
      "Type": "AWS::SNS::Subscription",
      "Properties": {
        "Endpoint": {
          "Ref": "SubscriptionEndPoint"
        },
        "Protocol": {
          "Ref": "SubscriptionProtocol"
        },
        "TopicArn": {
          "Ref": "SNSTopicSendSuccessEmail"
        }
      }
    }
  }
}