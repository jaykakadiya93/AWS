{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "LambdaFunction  for DynamoDB to S3 with DynamoDB Trigger Configurations",
  "Parameters": {
    "S3CodeDeployementBucket": {
      "Description": "S3 Code Deployment Code Bucket",
      "Type": "String"
    },
    "ZipFileName": {
      "Description": "ZIP File Name",
      "Type": "String"
    },
    "LambdaFunctionName": {
      "Description": "Lambda Function Name",
      "Type": "String"
    },
    "Role": {
      "Description": "Lambda creation Role",
      "Type": "String"
    },
    "BucketName": {
      "Description": "S3 bucket name",
      "Type": "String"
    }
  },
  "Resources": {
    "LambdaFunction": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "FunctionName": {
          "Ref": "LambdaFunctionName"
        },
        "Description": "Lambda function that returns.\n",
        "Code": {
          "S3Bucket": {
            "Ref": "S3CodeDeployementBucket"
          },
          "S3Key": {
            "Ref": "ZipFileName"
          }
        },
        "Handler": "index.lambda_handler",
        "MemorySize": 128,
        "Role": {
          "Ref": "Role"
        },
        "Runtime": "python3.6"
      }
    },
    "Script": {
      "Type": "AWS::EC2::Instance",
      "Properties": {
        "ImageId": "ami-02bcbb802e03574ba",
        "InstanceType": "t2.micro",
        "UserData": {
          "Fn::Base64": {
            "Fn::Join": [
              "",
              [
                "#!/bin/bash -v\n",
                "aws dynamodbstreams list-streams --table-name adobe_recipent\n"
              ]
            ]
          }
        }
      }
    },
    "DataTableStream": {
      "Type": "AWS::Lambda::EventSourceMapping",
      "Properties": {
        "BatchSize": 100,
        "Enabled": true,
        "EventSourceArn": "arn:aws:dynamodb:us-east-2:818411676569:table/adobe_recipent/stream/2019-03-14T19:41:21.376",
        "FunctionName": {
          "Fn::GetAtt": [
            "LambdaFunction",
            "Arn"
          ]
        },
        "StartingPosition": "LATEST"
      }
    }
  }
}